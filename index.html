<<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Volcano Client</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- <link rel="stylesheet" type="text/css" media="screen" href="main.css" /> -->
    <script src="./dist/volcano-client.js"></script>
  </head>
  <body>
    <div>
      <button onclick="testOn()">Test `on`</button>
      <button onclick="testOnce()">Test `once`</button>
      <button onclick="testOff()">Test `off`</button>
      <button onclick="testSet1()">Test `set` update</button>
      <button onclick="testSet2()">Test `set` create</button>
      <button onclick="testUpdate()">Test `update`</button>
      <button onclick="testPush()">Test `push`</button>
    </div>
    <script>
      const config = {
        serverURL: 'http://localhost:2306',
        bucketName: 'wildfire',
      }
      const app = volcano.default.initializeApp(config)
      const comments = []
      let handler
      const testOn = () => {
        handler = app.database().ref('comments').on('value', (snapshot) => {
          console.log('------on value------')
          console.log(snapshot)
          const data = snapshot.val()
          comments.push(data)
          console.log(snapshot.val())
          console.log(snapshot.key)
        })
      }
      const testOnce = () => {
        console.log('---once---')
        app.database().ref('comments/5a738755abe741e61a6295c5').once('value')
          .then(snapshot => {
            console.log('------once value------')
            console.log(snapshot)
            const data = snapshot.val()
            comments.push(data)
            console.log(snapshot.val())
            console.log(snapshot.key)
          })
          .catch(error => console.error(error))
      }
      const testOff = () => {
        handler((() => {console.log('off')}))
      }
      const testSet1 = () => {
        app.database().ref('comments/5a738755abe741e61a6295c5/author').set({ name: 'CK', gf: 'Catherine', hash: `${new Date().getTime() }` })
          .then(() => {
            console.log('-----set onComplete success----')
          })
          .catch(error => {
            console.log('-----set onComplete error-----')
            console.error(error)
          })
      }
      const testSet2 = () => {
        app.database().ref('comments/5a738755abe741e61a6295d6/author').set({ name: 'Catherine', bf: 'CK' })
          .then(() => {
            console.log('-----set onComplete success----')
          })
          .catch(error => {
            console.log('-----set onComplete error-----')
            console.error(error)
          })
      }
      const testUpdate = () => {
        app.database().ref('comments/5a738755abe741e61a6295d6/author').update({ updatedAt: `${new Date().getTime()}` })
          .then(() => {
            console.log('-----update onComplete success----')
          })
          .catch(error => {
            console.log('-----update onComplete error-----')
            console.error(error)
          })
      }
      const testPush = () => {
        app.database().ref('comments/').push({
          content: 'Push test',
          author: { 
            name: 'CK',
            gf: 'Catherine',
            hash: `${new Date().getTime()}`,
          },
        })
          .then(() => {
            console.log('-----push onComplete success----')
          })
          .catch(error => {
            console.log('-----push onComplete error-----')
            console.error(error)
          })
      }
    </script>
  </body>
</html>